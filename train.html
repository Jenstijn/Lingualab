<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>LinguaLab ‚Äî Oefenmodus (SRS)</title>
  <meta name="theme-color" content="#0b1021">
  <style>
    *,*::before,*::after{box-sizing:border-box}
    :root{--bg:#0c0e10;--panel:rgba(255,255,255,.08);--panel2:rgba(255,255,255,.12);--text:#e8ecf1;--muted:#a8b0ba;--hair:1px solid rgba(255,255,255,.14)}
    @media (prefers-color-scheme:light){:root{--bg:#f6f7fb;--panel:rgba(255,255,255,.65);--panel2:rgba(255,255,255,.8);--text:#0b1520;--muted:#536070;--hair:1px solid rgba(0,0,0,.08)}}
    html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,'SF Pro Text',system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    header{position:sticky;top:0;z-index:10;backdrop-filter:blur(18px) saturate(130%);background:linear-gradient(180deg,rgba(0,0,0,.25),rgba(0,0,0,.05));border-bottom:var(--hair);padding-top:env(safe-area-inset-top)}
    .wrap{max-width:820px;margin:0 auto;padding:16px}
    h1{margin:0;font-size:22px}
    .panel{background:var(--panel);border:var(--hair);border-radius:16px;padding:14px;backdrop-filter:blur(18px) saturate(130%);box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .small{font-size:12px;color:var(--muted)}
    .card{background:var(--panel2);border:var(--hair);border-radius:14px;padding:16px;margin-top:10px;min-height:140px}
    .mono{font-family:ui-monospace,Menlo,Consolas,monospace;white-space:pre-wrap}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    button{border:var(--hair);border-radius:12px;padding:10px 12px;background:linear-gradient(180deg,rgba(255,255,255,.12),rgba(255,255,255,.06));min-height:40px;color:var(--text)}
    .grade button{flex:1;min-width:40px}
    .muted{opacity:.7}
  </style>
</head>
<body>
<header><div class="wrap"><h1>LinguaLab ‚Äî Oefenmodus</h1><div class="small">Spaced repetition met SM‚Äë2 (light). <a style="color:#60a5fa" href="index.html">‚Ü©Ô∏é Terug</a> ‚Ä¢ <a style="color:#60a5fa" href="camera.html">üì∑ Camera</a></div></div></header>
<main class="wrap">
  <section class="panel">
    <div class="row">
      <span id="stats" class="small"></span>
      <button id="btnExport">‚ÜóÔ∏è Exporteer</button>
      <button id="btnImport">‚ÜôÔ∏è Importeer</button>
      <input id="file" type="file" accept="application/json" style="display:none">
      <button id="btnReset" class="muted">üóë Wis deck</button>
    </div>
    <div id="card" class="card">
      <div id="front" class="mono"></div>
      <div id="back" class="mono" style="display:none;margin-top:8px"></div>
    </div>
    <div class="row">
      <button id="btnShow">üëÄ Toon antwoord</button>
      <div class="grade" style="display:flex;gap:8px;flex:1">
        <button data-q="0">0</button>
        <button data-q="1">1</button>
        <button data-q="2">2</button>
        <button data-q="3">3</button>
        <button data-q="4">4</button>
        <button data-q="5">5</button>
      </div>
    </div>
  </section>
</main>

<script>
const FKEY='ll_srs_v1';
function getDeck(){ try{return JSON.parse(localStorage.getItem(FKEY))||[];}catch{return [];} }
function setDeck(d){ localStorage.setItem(FKEY, JSON.stringify(d||[])); }
function dueCards(){ const now=Date.now(); return getDeck().filter(c=> (c.due||0)<=now ); }

function schedule(card, q){
  let EF = card.ef ?? 2.5, I = card.int ?? 0, R = card.rep ?? 0;
  if (q < 3) { R = 0; I = 1; } else {
    EF = Math.max(1.3, EF + 0.1 - (5 - q) * (0.08 + (5 - q) * 0.02));
    if (R === 0) I = 1;
    else if (R === 1) I = 6;
    else I = Math.round(I * EF);
    R += 1;
  }
  card.ef = EF; card.int = I; card.rep = R; card.due = Date.now() + I*24*60*60*1000;
  return card;
}

const stats = document.getElementById('stats');
const front = document.getElementById('front');
const back = document.getElementById('back');
const btnShow = document.getElementById('btnShow');

let queue = [];
let current = null;

function refresh(){
  queue = dueCards();
  stats.textContent = 'Te doen: '+queue.length+' ‚Ä¢ Totaal kaarten: '+getDeck().length;
  nextCard();
}
function nextCard(){
  current = queue.shift() || null;
  if (!current) {
    front.textContent = 'üéâ Klaar voor vandaag! Voeg nieuwe kaarten toe via index of camera.';
    back.style.display='none'; btnShow.disabled=true; return;
  }
  front.textContent = (current.src||'')+' ‚Üí '+(current.dst||'')+'\\n\\n'+(current.front||'');
  back.textContent  = current.back||''; back.style.display='none';
  btnShow.disabled=false;
}
btnShow.addEventListener('click', ()=>{ back.style.display='block'; });

document.querySelectorAll('.grade button').forEach(b=>{
  b.addEventListener('click', ()=>{
    if (!current) return;
    const q=parseInt(b.dataset.q,10);
    const deck=getDeck();
    const i=deck.findIndex(c=>c.id===current.id);
    if(i>=0){ deck[i]=schedule(deck[i], q); setDeck(deck); }
    refresh();
  });
});

document.getElementById('btnExport').addEventListener('click', ()=>{
  const blob=new Blob([JSON.stringify(getDeck(),null,2)],{type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='lingualab_deck.json'; a.click();
});
const file=document.getElementById('file');
document.getElementById('btnImport').addEventListener('click', ()=> file.click());
file.addEventListener('change', async ()=>{
  if(!file.files.length) return; const f=file.files[0]; const txt=await f.text();
  try{ const arr=JSON.parse(txt); if(Array.isArray(arr)){ setDeck(arr); refresh(); } }catch{ alert('Kon JSON niet lezen.'); }
});
document.getElementById('btnReset').addEventListener('click', ()=>{ if(confirm('Deck wissen?')){ setDeck([]); refresh(); } });

refresh();
</script>
</body>
</html>
